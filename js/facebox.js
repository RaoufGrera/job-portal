(function(a){function e(b){if(a.facebox.settings.inited)return!0;a.facebox.settings.inited=!0;a(document).trigger("init.facebox");l();var c=a.facebox.settings.imageTypes.join("|");a.facebox.settings.imageTypesRegexp=new RegExp(".("+c+")$","i");b&&a.extend(a.facebox.settings,b);a("body").append(a.facebox.settings.faceboxHtml);var d=[new Image,new Image];d[0].src=a.facebox.settings.closeImage;d[1].src=a.facebox.settings.loadingImage;a("#facebox").find(".b:first, .bl").each(function(){d.push(new Image); d.slice(-1).src=a(this).css("background-image").replace(/url\((.+)\)/,"$1")});a("#facebox .close").click(a.facebox.close);a("#facebox .close_image").attr("src",a.facebox.settings.closeImage)}function m(){var a,c;self.pageYOffset?(c=self.pageYOffset,a=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(c=document.documentElement.scrollTop,a=document.documentElement.scrollLeft):document.body&&(c=document.body.scrollTop,a=document.body.scrollLeft);return[a,c]}function n(){var a; self.innerHeight?a=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&(a=document.body.clientHeight);return a}function l(){var b=a.facebox.settings;b.loadingImage=b.loading_image||b.loadingImage;b.closeImage=b.close_image||b.closeImage;b.imageTypes=b.image_types||b.imageTypes;b.faceboxHtml=b.facebox_html||b.faceboxHtml}function f(b,c){if(b.match(/#/)){var d=window.location.href.split("#")[0],d=b.replace(d,"");"#"!= d&&a.facebox.reveal(a(d).html(),c)}else b.match(a.facebox.settings.imageTypesRegexp)?g(b,c):h(b,c)}function g(b,c){var d=new Image;d.onload=function(){a.facebox.reveal('<div class="image"><img src="'+d.src+'" /></div>',c)};d.src=b}function h(b,c){a.get(b,function(b){a.facebox.reveal(b,c)})}function k(){return 0==a.facebox.settings.overlay||null===a.facebox.settings.opacity}function p(){if(!k())return 0==a("#facebox_overlay").length&&a("body").append('<div id="facebox_overlay" class="facebox_hide"></div>'), a("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",a.facebox.settings.opacity).click(function(){a(document).trigger("close.facebox")}).fadeIn(200),!1}function q(){if(!k())return a("#facebox_overlay").fadeOut(200,function(){a("#facebox_overlay").removeClass("facebox_overlayBG");a("#facebox_overlay").addClass("facebox_hide");a("#facebox_overlay").remove()}),!1}a.facebox=function(b,c){a.facebox.loading();b.ajax?h(b.ajax,c):b.image?g(b.image,c):b.div?f(b.div,c):a.isFunction(b)?b.call(a): a.facebox.reveal(b,c)};a.extend(a.facebox,{settings:{opacity:.2,overlay:!0,loadingImage:"/facebox/loading.gif",closeImage:"images/closelabel.png",imageTypes:["png","jpg","jpeg","gif"],faceboxHtml:' <div id="facebox" style="display:none;"> <div class="popup"> <div class="contentbox"> </div> <a href="#" class="close"><img src="../images/closelabel.png" title="close" class="close_image" /></a> </div> </div>'},loading:function(){e();if(1==a("#facebox .loading").length)return!0; p();a("#facebox .contentbox").empty();a("#facebox .body").children().hide().end().append('<div class="loading"><img src="'+a.facebox.settings.loadingImage+'"/></div>');a("#facebox").css({top:m()[1]+n()/10,left:a(window).width()/2-205}).show();a(document).bind("keydown.facebox",function(b){27==b.keyCode&&a.facebox.close();return!0});a(document).trigger("loading.facebox")},reveal:function(b,c){a(document).trigger("beforeReveal.facebox");c&&a("#facebox .contentbox").addClass(c);a("#facebox .contentbox").append(b); a("#facebox .loading").remove();a("#facebox .body").children().fadeIn("normal");a("#facebox").css("left",a(window).width()/2-a("#facebox .popup").width()/2);a(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){a(document).trigger("close.facebox");return!1}});a.fn.facebox=function(b){function c(){a.facebox.loading(!0);var b=this.rel.match(/facebox\[?\.(\w+)\]?/);b&&(b=b[1]);f(this.href,b);return!1}if(0!=a(this).length)return e(b),this.bind("click.facebox",c)};a(document).bind("close.facebox", function(){a(document).unbind("keydown.facebox");a("#facebox").fadeOut(function(){a("#facebox .contentbox").removeClass().addClass("contentbox");a("#facebox .loading").remove();a(document).trigger("afterClose.facebox")});q()})})(jQuery);